#!/bin/bash
# –ë—ã—Å—Ç—Ä—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–æ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

set -e

BOT_DIR="/opt/uspsocdowloader"
BOT_USER="uspbot"
BOT_SERVICE="uspsocdowloader"

echo "üîÑ –û–±–Ω–æ–≤–ª—è–µ–º UspSocDownloader..."

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –±–æ—Ç–∞
cd "$BOT_DIR"

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–æ—Ç
echo "‚èπÔ∏è –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–æ—Ç..."
systemctl stop "$BOT_SERVICE" || true

# –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥
echo "üì• –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥..."
sudo -u "$BOT_USER" git pull origin master

# –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo "üì¶ –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
sudo -u "$BOT_USER" .venv/bin/pip install -r requirements.txt --upgrade

# –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç
echo "‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç..."
systemctl start "$BOT_SERVICE"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
sleep 2
systemctl status "$BOT_SERVICE"

echo "‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
