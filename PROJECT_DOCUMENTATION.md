# UspSocDownloader - Telegram Bot

## Обзор проекта

**UspSocDownloader** — Telegram-бот для скачивания медиаконтента из популярных социальных сетей. Бот позволяет пользователям скачивать видео, фото, аудио и карусели из Instagram, TikTok, YouTube, Twitter/X и Facebook, просто отправив ссылку на пост.

### Основная цель
Предоставить пользователям удобный инструмент для сохранения медиаконтента из социальных сетей без необходимости устанавливать сторонние приложения или использовать сомнительные веб-сервисы.

---

## Технологический стек

### Backend
- **Python 3.11** — основной язык программирования
- **aiogram 3.x** — асинхронный фреймворк для Telegram Bot API
- **yt-dlp** — библиотека для скачивания видео с 1000+ платформ
- **gallery-dl** — специализированная библиотека для Instagram
- **asyncio** — асинхронное выполнение операций
- **ffmpeg** — обработка и конвертация медиафайлов

### Хранение данных
- **Google Sheets API** — хранение статистики пользователей и запросов
- **gspread** — Python-клиент для Google Sheets
- **JSON-файлы** — кэширование и локальное хранение

### AI/ML интеграции
- **OpenAI GPT-4** — перевод текста, рерайт в разных стилях
- **Claude (Anthropic)** — альтернативная AI-модель
- **OpenAI Vision** — OCR (распознавание текста на изображениях)

### Инфраструктура
- **Ubuntu Linux** — серверная ОС
- **systemd** — управление сервисами
- **Nginx** — reverse proxy (опционально)

---

## Поддерживаемые платформы

### Instagram
- **Посты** — фото и видео
- **Reels** — короткие вертикальные видео
- **Карусели** — множественные фото/видео в одном посте
- **Требования:** Cookies для авторизации (обход ограничений Instagram)

### TikTok
- **Видео** — скачивание без водяного знака
- **Поддержка:** Короткие и длинные ссылки (vm.tiktok.com)

### YouTube
- **Видео** — с выбором качества (360p, 480p, 720p, 1080p)
- **Shorts** — короткие вертикальные видео
- **Аудио** — извлечение MP3 из видео
- **Ограничения:** 360p бесплатно, HD для Premium

### Twitter / X
- **Видео** — из твитов
- **Фото** — изображения из твитов
- **GIF** — анимированные изображения
- **Quote tweets** — видео из цитируемых твитов

### Facebook
- **Публичные видео** — без авторизации
- **Reels** — короткие видео

---

## Функциональные возможности

### Основные функции

#### 1. Скачивание медиа
- Автоматическое определение платформы по URL
- Поддержка различных типов контента
- Извлечение метаданных (автор, описание, статистика)
- Отображение прогресса загрузки

#### 2. AI-функции
- **Перевод** — автоматический перевод описаний на русский
- **Рерайт** — переписывание текста в разных стилях:
  - Экспертный стиль
  - Юмористический стиль
  - Дружелюбный стиль
  - Свой стиль (Premium)
- **OCR** — распознавание текста с изображений

#### 3. Система Premium
- **Безлимитные скачивания** (vs 10/день для бесплатных)
- **HD качество YouTube** (720p, 1080p)
- **Уникальные стили рерайта**
- **Приоритетная очередь**
- **Без рекламы**

### Команды бота

#### Пользовательские команды
| Команда | Описание |
|---------|----------|
| `/start` | Приветствие и быстрый старт |
| `/help` | Справка по использованию |
| `/platforms` | Список поддерживаемых платформ |
| `/premium` | Тарифы и оплата Premium |
| `/stats` | Личная статистика пользователя |
| `/ref` | Реферальная ссылка |

#### Админские команды
| Команда | Описание |
|---------|----------|
| `/admin` | Админ-панель |
| `/allstats` | Общая статистика бота |
| `/users` | Список последних пользователей |
| `/broadcast <текст>` | Рассылка всем пользователям |
| `/checkinstagram` | Проверка подключения к Instagram |
| `/setcookies` | Обновление Instagram cookies |

---

## Архитектура проекта

### Структура каталогов
```
/opt/uspsocdowloader/
├── run_bot.py              # Точка входа
├── .env                    # Конфигурация (токены, ключи)
├── instagram_cookies.txt   # Cookies для Instagram
├── src/
│   ├── bot.py              # Инициализация бота
│   ├── config.py           # Загрузка конфигурации
│   ├── handlers/
│   │   ├── start.py        # Обработчик /start
│   │   ├── help.py         # Обработчик /help
│   │   ├── commands.py     # Пользовательские и админ команды
│   │   └── url_handler.py  # Обработка URL и скачивание
│   ├── downloaders/
│   │   └── media_downloader.py  # Логика скачивания
│   ├── processors/
│   │   └── url_processor.py     # Парсинг и валидация URL
│   ├── utils/
│   │   ├── logger.py            # Логирование
│   │   ├── sheets.py            # Google Sheets интеграция
│   │   ├── notifications.py     # Уведомления в супергруппу
│   │   ├── translator.py        # AI перевод и рерайт
│   │   ├── validators.py        # Валидация данных
│   │   ├── cache.py             # Кэширование
│   │   └── instagram_health.py  # Проверка Instagram
│   └── localization/
│       └── messages.py          # Тексты сообщений
├── data/
│   ├── videos/             # Скачанные видео
│   ├── audio/              # Скачанные аудио
│   ├── photos/             # Скачанные фото
│   └── cookies/            # Cookies файлы
└── logs/
    └── bot.log             # Логи приложения
```

### Поток обработки запроса

```
1. Пользователь отправляет URL
         ↓
2. url_handler.py получает сообщение
         ↓
3. MessageValidator проверяет и извлекает URL
         ↓
4. URLProcessor определяет платформу и тип контента
         ↓
5. Проверка лимитов (для бесплатных пользователей)
         ↓
6. MediaDownloader скачивает контент
   - yt-dlp для видео
   - gallery-dl для Instagram
         ↓
7. Извлечение метаданных
         ↓
8. Отправка файла пользователю
         ↓
9. Логирование в Google Sheets
         ↓
10. Уведомление в супергруппу админа
```

---

## Интеграции

### Google Sheets
**Назначение:** Хранение данных пользователей и статистики

**Листы:**
- **Users** — информация о пользователях
  - user_id, username, first_name, last_name
  - language, is_telegram_premium
  - first_seen, last_seen
  - total_requests, referrer_id
  - is_premium, premium_until

- **Requests** — логи запросов
  - timestamp, user_id, username
  - platform, content_type, url
  - success, error_message
  - file_size_mb, duration_sec
  - processing_time

- **Errors** — логи ошибок для отладки

### Telegram Супергруппа
**Назначение:** Уведомления админу в реальном времени

**Топики:**
- Новые пользователи
- Запросы на скачивание
- Успешные скачивания
- Ошибки

### OpenAI API
**Назначение:** AI-функции

**Используемые модели:**
- **gpt-4o-mini** — перевод и рерайт текста
- **gpt-4o** — OCR (распознавание текста с изображений)

---

## Монетизация

### Модель Freemium

**Бесплатно:**
- 10 скачиваний в день
- YouTube только в 360p
- Базовые стили рерайта
- Реклама (планируется)

**Premium (подписка):**
| Период | Цена | Экономия |
|--------|------|----------|
| 1 месяц | 199 ₽ | — |
| 3 месяца | 499 ₽ | 16% |
| 1 год | 1499 ₽ | 37% |

**Способы оплаты:**
- Банковская карта (Visa/MasterCard/МИР)
- СБП (Система быстрых платежей)
- ЮMoney

### Реферальная система
- Уникальная ссылка для каждого пользователя
- Бонусы за привлечённых пользователей (планируется)

---

## Лимиты и ограничения

### Технические лимиты
| Параметр | Значение |
|----------|----------|
| Макс. размер видео | 50 MB (Telegram Bot API) |
| Макс. размер аудио | 100 MB |
| Макс. размер фото | 10 MB |
| Таймаут загрузки | 60 секунд |
| Ретраи при ошибке | 3 попытки |

### Бизнес-лимиты
| Параметр | Бесплатно | Premium |
|----------|-----------|---------|
| Скачиваний в день | 10 | Безлимит |
| YouTube качество | 360p | До 1080p |

---

## Сценарии использования

### 1. SMM-специалист
**Цель:** Сохранение контента конкурентов для анализа
**Сценарий:**
1. Находит интересный пост конкурента
2. Отправляет ссылку боту
3. Получает видео + описание
4. Использует AI для рерайта описания

### 2. Контент-мейкер
**Цель:** Репост контента с указанием авторства
**Сценарий:**
1. Скачивает видео из TikTok
2. Получает его без водяного знака
3. Публикует в своём канале

### 3. Обычный пользователь
**Цель:** Сохранить понравившееся видео
**Сценарий:**
1. Видит интересный Reels в Instagram
2. Копирует ссылку
3. Отправляет боту
4. Получает видео в телефон

### 4. Музыкальный энтузиаст
**Цель:** Скачать музыку с YouTube
**Сценарий:**
1. Находит трек на YouTube
2. Отправляет ссылку боту
3. Выбирает "Только звук (MP3)"
4. Получает аудиофайл

---

## Целевая аудитория

### Демография
- **Возраст:** 16-45 лет
- **География:** Россия, СНГ
- **Язык:** Русский

### Сегменты
1. **SMM-специалисты** (30%)
   - Анализ контента конкурентов
   - Сбор референсов

2. **Контент-мейкеры** (25%)
   - Репосты с указанием источника
   - Создание компиляций

3. **Обычные пользователи** (35%)
   - Сохранение понравившегося контента
   - Отправка друзьям

4. **Маркетологи** (10%)
   - Исследование трендов
   - Конкурентный анализ

---

## Безопасность

### Защита данных
- Файлы автоматически удаляются через 24 часа
- Cookies хранятся локально на сервере
- Токены в переменных окружения (.env)

### Ограничения
- Проверка размера файлов
- Rate limiting для предотвращения абузов
- Валидация URL перед обработкой

---

## Мониторинг и обслуживание

### Instagram Health Check
- Автоматическая проверка cookies каждые 12 часов
- Уведомление админу при проблемах
- Команда `/setcookies` для обновления

### Логирование
- Уровни: DEBUG, INFO, WARNING, ERROR
- Ротация логов
- Запись в файл и Google Sheets

### Очистка
- Автоматическое удаление файлов старше 24 часов
- Периодическая очистка каждый час

---

## Планы развития

### Фаза 1: Стабилизация
- [ ] Мониторинг ошибок и исправление багов
- [ ] Улучшение обработки ошибок
- [ ] Добавить поддержку Pinterest
- [ ] Добавить поддержку Reddit

### Фаза 2: Монетизация
- [ ] Интеграция с ЮKassa/Tinkoff
- [ ] Автоматическое присвоение Premium
- [ ] Промокоды на Premium

### Фаза 3: Новые функции
- [ ] Скачивание плейлистов YouTube
- [ ] Скачивание Stories Instagram
- [ ] Конвертация видео в GIF
- [ ] Обрезка видео по таймкодам

### Фаза 4: Масштабирование
- [ ] Очередь задач (Redis)
- [ ] Несколько воркеров
- [ ] CDN для раздачи файлов
- [ ] Кэширование популярных видео

---

## Контакты

- **Поддержка:** @smit_support
- **GitHub:** https://github.com/ircitdev/UspSocDownloader

---

*Документация актуальна на декабрь 2025*
